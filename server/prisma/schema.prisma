generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum Role {
  USER
  ADMIN
}

enum StatusNotificationEvent  {
  PENDING
  SCHEDULED
  SENT
  FAILED
}

model User {
  id          String      @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  name        String
  email       String      @unique
  password    String
  createdAt   DateTime    @default(now()) @db.Timestamptz(6)
  role        Role        @default(USER)
  status      Boolean     @default(true)
  links       Link[]
  eventos     Evento[]
  anotacoes   Anotacao[]
  tags        Tag[]
  device_token DeviceToken[]
  newsletter  Newsletter?
}

model Categoria {
  id          String      @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  nome        String
  userId      String      @db.Uuid
  links       Link[]
  eventos     Evento[]
  anotacoes   Anotacao[]
}

model Estado {
  id          String      @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  nome        String
  links       Link[]
}

model Tag {
  id          String      @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  nome        String
  userId      String      @db.Uuid
  user        User        @relation(fields: [userId], references: [id])
  tagRelacionadas TagRelacionada[]
}

model TagRelacionada {
  id          String      @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid

  tagId       String      @db.Uuid
  tag         Tag         @relation(fields: [tagId], references: [id])

  linkId      String?     @db.Uuid
  link        Link?       @relation(fields: [linkId], references: [id])

}

model Newsletter {
  id          String      @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  userId      String      @unique @db.Uuid
  user        User        @relation(fields: [userId], references: [id])
  // outros campos da newsletter aqui
}

model Link {
  id              String      @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  userId          String      @db.Uuid
  user            User        @relation(fields: [userId], references: [id])
  categoriaId     String?     @db.Uuid
  categoria       Categoria?  @relation(fields: [categoriaId], references: [id])
  estadoId        String?     @db.Uuid
  estado          Estado?     @relation(fields: [estadoId], references: [id])
  title           String      
  link            String      
  description     String?
  tagRelacionadas TagRelacionada[]
  notification    String?
  summary_link    Boolean     @default(false)
}

model Evento {
  id          String      @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  userId      String      @db.Uuid
  user        User        @relation(fields: [userId], references: [id])
  title       String
  address      String?
  description String?
  date        DateTime?
  notification Boolean?
  scheduleAt   String?
  expired      Boolean?
  statusNotification       StatusNotificationEvent?
  categoriaId String?      @db.Uuid
  categoria   Categoria?   @relation(fields: [categoriaId], references: [id])
}

model DeviceToken {
  id          String      @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  userId      String      @db.Uuid
  user        User        @relation(fields: [userId], references: [id])
  token       String      @unique
  createdAt   DateTime    @default(now()) @db.Timestamptz(6)
  updatedAt   DateTime    @updatedAt @db.Timestamptz(6)
}


model Anotacao {
  id          String      @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  userId      String      @db.Uuid
  user        User        @relation(fields: [userId], references: [id])
  categoriaId String      @db.Uuid
  categoria   Categoria   @relation(fields: [categoriaId], references: [id])
  title       String      
  annotation  String
  updatedAt   DateTime    @updatedAt @db.Timestamptz(6)
}
